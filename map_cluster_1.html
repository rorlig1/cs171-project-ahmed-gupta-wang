<!DOCTYPE html>
<html>
<head>
	<title>Leaflet debug page</title>

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="screen.css" />

	<link rel="stylesheet" href="dist/MarkerCluster.css" />
	<link rel="stylesheet" href="dist/MarkerCluster.Default.css" />
	<script src="./dist/leaflet.markercluster-src.js"></script>
	<script src="js/d3.js"></script>
		<script src="js/underscore.js"></script>

</head>
<body>

	<div id="map"></div>
	<button id="populate">Populate 1 marker</button>
	<button id="remove">Remove 1 marker</button>

	<script type="text/javascript">

		var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
			}),
			latlng = L.latLng( 33.43  112.02 );


		var map = L.map('map', {center: latlng, zoom: 11, layers: [tiles]});


		var markers = L.markerClusterGroup({spiderfyOnMaxZoom: true, showCoverageOnHover: true, zoomToBoundsOnClick: true, disableClusteringAtZoom: 15, spiderfyDistanceMultiplier: 2, maxClusterRadius: 70})

		function populate(data) {
			_.each(data, function(elem) {
				var m = L.marker(getRandomLatLng(elem));
				markers.addLayer(m);

			})
			return false;
		}
		function getRandomLatLng(elem) {
			// var bounds = map.getBounds(),
			// 	southWest = bounds.getSouthWest(),
			// 	northEast = bounds.getNorthEast(),
			// 	lngSpan = northEast.lng - southWest.lng,
			// 	latSpan = northEast.lat - southWest.lat;

			console.log(elem.latitude);

			var latlng =  L.latLng(
					elem.latitude,
					elem.longitude);
			
			console.log(latlng);
			return latlng;
		}

		markers.on('clusterclick', function (a) {
			a.layer.zoomToBounds();
		});
		d3.json('data_with_open/output_phoenix_all.json', function (error, data) {
			populate(data);
			map.addLayer(markers);
		})
	</script>
</body>
</html>
